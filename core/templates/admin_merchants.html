{% extends "base_admin.html" %}
{% block title %}Merchants & POS - StayToken{% endblock %}
{% block content %}
<div class="space-y-4 pb-16">
  <section class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="flex items-start gap-2.5">
      <div class="grid h-10 w-10 place-items-center rounded-xl bg-slate-900 text-xs font-semibold text-white">MRC</div>
      <div class="min-w-0">
        <h1 class="text-base font-semibold text-slate-900">Merchants & POS activity</h1>
        <p class="text-sm text-slate-500">Monitor voucher redemptions performed at POS terminals and identify performance trends.</p>
      </div>
    </div>
    <form method="get" class="mt-3 flex flex-wrap items-center gap-2">
      <label class="text-sm text-slate-600">Status
        <select name="status" class="ml-2 rounded-xl border p-2 text-sm">
          <option value="" {% if not status %}selected{% endif %}>All</option>
          <option value="reserved" {% if status == 'reserved' %}selected{% endif %}>Reserved</option>
          <option value="committed" {% if status == 'committed' %}selected{% endif %}>Committed</option>
          <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>Cancelled</option>
        </select>
      </label>
      <label class="text-sm text-slate-600">Time range
        <select name="days" class="ml-2 rounded-xl border p-2 text-sm">
          <option value="1" {% if days == 1 %}selected{% endif %}>Last 24 hours</option>
          <option value="7" {% if days == 7 %}selected{% endif %}>Last 7 days</option>
          <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 days</option>
        </select>
      </label>
      <button class="rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white">Apply</button>
      <a href="?" class="rounded-xl border px-3 py-2 text-sm text-slate-600 hover:bg-slate-50">Reset</a>
    </form>
  </section>

  <section class="rounded-2xl border bg-white shadow-sm">
    <div class="overflow-x-auto">
      <div class="min-w-[640px]">
        <div class="grid grid-cols-7 gap-0 border-b bg-slate-50 px-4 py-2 text-[11px] font-medium uppercase tracking-wide text-slate-500">
          <div>Reserved at</div>
          <div>Voucher</div>
          <div>Amount</div>
          <div>Status</div>
          <div>Terminal</div>
          <div>Merchant</div>
          <div>Committed at</div>
        </div>
        <div class="divide-y">
          {% for it in page_obj.object_list %}
          <div class="grid grid-cols-7 gap-2 px-4 py-3 text-sm">
            <div>{{ it.reserved_at|date:'Y-m-d H:i'|default:"N/A" }}</div>
            <div class="truncate" title="{{ it.voucher_type.name }}">{{ it.voucher_type.slug }}</div>
            <div>{{ it.amount }}</div>
            <div>
              {% if it.status == 'committed' %}
                <span class="rounded-full border border-emerald-100 bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700">Committed</span>
              {% elif it.status == 'reserved' %}
                <span class="rounded-full border border-amber-100 bg-amber-50 px-2 py-0.5 text-[11px] text-amber-700">Reserved</span>
              {% elif it.status == 'cancelled' %}
                <span class="rounded-full border border-rose-100 bg-rose-50 px-2 py-0.5 text-[11px] text-rose-600">Cancelled</span>
              {% else %}
                <span class="rounded-full border px-2 py-0.5 text-[11px] text-slate-600">{{ it.status }}</span>
              {% endif %}
            </div>
            <div class="truncate" title="{{ it.display_terminal }}">{{ it.display_terminal }}</div>
            <div class="truncate" title="{{ it.display_merchant }}">{{ it.display_merchant }}</div>
            <div>{{ it.committed_at|date:'Y-m-d H:i'|default:"N/A" }}</div>
          </div>
          {% empty %}
          <div class="px-4 py-6 text-sm text-slate-500">No data.</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="flex items-center justify-between border-t bg-slate-50 px-4 py-2 text-sm">
      <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      <div class="flex items-center gap-2">
        {% if page_obj.has_previous %}
          <a class="rounded border px-2 py-1" href="?page={{ page_obj.previous_page_number }}&status={{ status }}&days={{ days }}">Previous</a>
        {% else %}
          <span class="cursor-not-allowed rounded border px-2 py-1 text-slate-400">Previous</span>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="rounded border px-2 py-1" href="?page={{ page_obj.next_page_number }}&status={{ status }}&days={{ days }}">Next</a>
        {% else %}
          <span class="cursor-not-allowed rounded border px-2 py-1 text-slate-400">Next</span>
        {% endif %}
      </div>
    </div>
  </section>
</div>
{% endblock %}








